(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-73ffed14","chunk-4914bac6"],{1115:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"api-info-container"},[a("el-form",{ref:"apiForm",attrs:{model:t.apiForm,rules:t.rules,"label-width":"160px"}},[a("el-card",{staticClass:"form-section"},[a("div",{attrs:{slot:"header"},slot:"header"},[t._v("API 基础信息")]),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"Sample URL:",prop:"sample_url"}},[a("el-input",{attrs:{placeholder:"https://api.example.com/v1/resource/{id}"},model:{value:t.apiForm.sample_url,callback:function(e){t.$set(t.apiForm,"sample_url",e)},expression:"apiForm.sample_url"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"Request Method:",prop:"request_method"}},[a("el-select",{staticStyle:{width:"100%"},model:{value:t.apiForm.request_method,callback:function(e){t.$set(t.apiForm,"request_method",e)},expression:"apiForm.request_method"}},t._l(t.methods,(function(t){return a("el-option",{key:t,attrs:{value:t}})})),1)],1)],1)],1)],1),a("el-card",{staticClass:"form-section"},[a("div",{attrs:{slot:"header"},slot:"header"},[t._v("路径参数 (Path Segments)")]),t._l(t.apiForm.path_segment_list,(function(e,i){return a("div",{key:i,staticClass:"dynamic-item"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"参数"+(i+1)+"名称:",prop:"path_segment_list."+i+".name",rules:t.rules.path_segment_name}},[a("el-input",{model:{value:e.name,callback:function(a){t.$set(e,"name",a)},expression:"segment.name"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"是否为路径变量:"}},[a("el-switch",{attrs:{"active-text":"是","inactive-text":"否"},model:{value:e.is_path_variable,callback:function(a){t.$set(e,"is_path_variable",a)},expression:"segment.is_path_variable"}})],1)],1),a("el-col",{attrs:{span:8}},[i>=0?a("el-button",{attrs:{type:"danger",icon:"el-icon-delete"},on:{click:function(e){return t.removePathSegment(i)}}}):t._e()],1)],1)],1)})),a("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:t.addPathSegment}},[t._v("添加路径参数")])],2),a("el-card",{staticClass:"form-section"},[a("div",{attrs:{slot:"header"},slot:"header"},[t._v("请求参数 (Request Params)")]),t._l(t.apiForm.request_param_list,(function(e,i){return a("div",{key:i,staticClass:"dynamic-item"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"参数"+(i+1)+"名称:",prop:"request_param_list."+i+".name",rules:t.rules.param_name}},[a("el-input",{model:{value:e.name,callback:function(a){t.$set(e,"name",a)},expression:"param.name"}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"是否必需:"}},[a("el-switch",{attrs:{"active-text":"是","inactive-text":"否"},model:{value:e.is_necessary,callback:function(a){t.$set(e,"is_necessary",a)},expression:"param.is_necessary"}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"参数类型:"}},[a("el-select",{model:{value:e.type,callback:function(a){t.$set(e,"type",a)},expression:"param.type"}},t._l(t.types,(function(t){return a("el-option",{key:t,attrs:{value:t}})})),1)],1)],1),a("el-col",{attrs:{span:6}},[i>0?a("el-button",{attrs:{type:"danger",icon:"el-icon-delete"},on:{click:function(e){return t.removeRequestParam(i)}}}):t._e()],1)],1)],1)})),a("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:t.addRequestParam}},[t._v("添加请求参数")])],2),a("el-card",{staticClass:"form-section"},[a("div",{attrs:{slot:"header"},slot:"header"},[t._v("功能描述")]),a("el-form-item",{attrs:{prop:"function_description"}},[a("el-input",{attrs:{type:"textarea",rows:3,placeholder:"简要功能描述（示例：用户访问自己账户的邮件编辑页面）"},model:{value:t.apiForm.function_description,callback:function(e){t.$set(t.apiForm,"function_description",e)},expression:"apiForm.function_description"}})],1)],1),a("el-card",{staticClass:"form-section"},[a("div",{attrs:{slot:"header"},slot:"header"},[t._v("权限信息")]),a("el-form-item",{attrs:{prop:"permission_info"}},[a("el-input",{attrs:{type:"textarea",rows:3,placeholder:"描述正常授权情况及未授权场景（示例：已登录用户可访问，未登录用户访问属于未授权）"},model:{value:t.apiForm.permission_info,callback:function(e){t.$set(t.apiForm,"permission_info",e)},expression:"apiForm.permission_info"}})],1)],1),a("div",{staticClass:"form-actions"},[a("el-button",{attrs:{type:"primary"},on:{click:t.submitForm}},[t._v("保存")]),a("el-button",{on:{click:t.cancelForm}},[t._v("取消")])],1)],1)],1)},r=[],s=a("5530"),n=(a("a434"),a("b64b"),a("61f7")),o={name:"ApiInfoForm",props:{apiData:{type:Object,default:function(){return{}}}},data:function(){return{methods:["GET","POST","PUT","DELETE","PATCH"],types:["String","Number","Boolean","Object","Array"],apiForm:{sample_url:"",request_method:"GET",path_segment_list:[{name:"",is_path_variable:!1}],request_param_list:[{name:"",type:"String"}],function_description:"",permission_info:""},rules:{sample_url:[{required:!0,message:"示例URL不能为空",trigger:"blur"},{validator:function(t,e,a){return Object(n["d"])(e)?a():a(new Error("URL格式不正确"))},trigger:"blur"}],request_method:{required:!0,message:"请选择请求方法",trigger:"change"},path_segment_name:{required:!0,message:"参数名称不能为空",trigger:"blur"},param_name:{required:!0,message:"参数名称不能为空",trigger:"blur"},function_description:{required:!0,message:"功能描述不能为空",trigger:"blur"},permission_info:{required:!0,message:"权限信息不能为空",trigger:"blur"}}}},watch:{apiData:{immediate:!0,handler:function(t){t&&Object.keys(t).length>0&&(this.apiForm=Object(s["a"])(Object(s["a"])({},t),{},{path_segment_list:t.path_segment_list||[{name:"",is_path_variable:!1}],request_param_list:t.request_param_list||[{name:"",is_necessary:!1,type:"String"}]}))}}},methods:{submitForm:function(){var t=this;this.$refs.apiForm.validate((function(e){e&&t.$emit("save",t.apiForm)}))},cancelForm:function(){this.$emit("cancel")},addPathSegment:function(){this.apiForm.path_segment_list.push({name:"",is_path_variable:!1})},removePathSegment:function(t){this.apiForm.path_segment_list.length>=1&&this.apiForm.path_segment_list.splice(t,1)},addRequestParam:function(){this.apiForm.request_param_list.push({name:"",is_necessary:!1,type:"String"})},removeRequestParam:function(t){this.apiForm.request_param_list.length>1&&this.apiForm.request_param_list.splice(t,1)}}},l=o,c=(a("5825"),a("2877")),u=Object(c["a"])(l,i,r,!1,null,"e06ec0f8",null);e["default"]=u.exports},3747:function(t,e,a){},"3b56":function(t,e,a){},5825:function(t,e,a){"use strict";a("3747")},"949f":function(t,e,a){"use strict";a.d(e,"f",(function(){return r})),a.d(e,"j",(function(){return s})),a.d(e,"o",(function(){return n})),a.d(e,"n",(function(){return o})),a.d(e,"k",(function(){return l})),a.d(e,"r",(function(){return c})),a.d(e,"q",(function(){return u})),a.d(e,"a",(function(){return p})),a.d(e,"g",(function(){return d})),a.d(e,"i",(function(){return m})),a.d(e,"m",(function(){return f})),a.d(e,"l",(function(){return h})),a.d(e,"e",(function(){return _})),a.d(e,"d",(function(){return b})),a.d(e,"b",(function(){return v})),a.d(e,"c",(function(){return g})),a.d(e,"h",(function(){return y})),a.d(e,"p",(function(){return w}));var i=a("b775");function r(t){return Object(i["a"])({url:"/api/target-app-list/",method:"get",params:t})}function s(t){return Object(i["a"])({url:"/api/target-app/",method:"get",params:t})}function n(t,e){return Object(i["a"])({url:"/api/target-app/",method:"put",params:{id:t},data:e})}function o(t){return Object(i["a"])({url:"/api/target-app/",method:"post",params:{},data:t})}function l(t){return Object(i["a"])({url:"/api/detection/features/",method:"get",params:t})}function c(t,e){return Object(i["a"])({url:"/api/detection/features/",method:"put",params:{app_id:t},data:e})}function u(t,e){return Object(i["a"])({url:"/api/detection/config/",method:"put",params:{app_id:t},data:e})}function p(t){return Object(i["a"])({url:"/api/api-discovery/start/",method:"get",params:t})}function d(t){return Object(i["a"])({url:"/api/api-discovery/status/",method:"get",params:t})}function m(t){return Object(i["a"])({url:"/api/api-discovery/manual/status/",method:"get",params:t})}function f(t){return Object(i["a"])({url:"/api/model-construct",method:"get",params:t})}function h(t){return Object(i["a"])({url:"/api/model-construct/data-collection-status/",method:"get",params:t})}function _(t){return Object(i["a"])({url:"/api/detection/start/",method:"get",params:t})}function b(t){return Object(i["a"])({url:"/api/detection/pause/",method:"get",params:t})}function v(t){return Object(i["a"])({url:"/api/api-discovery/cancel/",method:"get",params:t})}function g(t){return Object(i["a"])({url:"/api/api-discovery/finish/",method:"get",params:t})}function y(t){return Object(i["a"])({url:"/api/api-lists/",method:"get",params:t})}function w(t,e){return Object(i["a"])({url:"/api/v2/user-api-list/",method:"put",params:{app_id:t},data:e})}},"969c":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("div",{staticClass:"submit-button"},[a("el-button",{attrs:{type:"primary"},on:{click:t.submitUserApiList}},[t._v("提交")])],1),a("div",{staticClass:"table-section"},[a("h2",{staticClass:"table-title"},[t._v("Discovered API")]),a("div",{staticClass:"table-wrapper"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],key:t.tableKey,staticStyle:{width:"100%"},attrs:{data:t.discoveredApiList,border:"",fit:"","highlight-current-row":""}},[a("el-table-column",{attrs:{label:"ID",prop:"id",align:"center",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[a("span",[t._v(t._s(i.id))])]}}])}),a("el-table-column",{attrs:{label:"Method",width:"150px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[a("span",[t._v(t._s(i.request_method))])]}}])}),a("el-table-column",{attrs:{label:"Path","min-width":"150px"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[a("span",{staticClass:"link-type"},[t._v(t._s(i.sample_url))])]}}])}),a("el-table-column",{attrs:{label:"Description",width:"310px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[a("span",[t._v(t._s(i.function_description))])]}}])}),a("el-table-column",{attrs:{label:"Actions",width:"110px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.moveToUserApiList(i)}}},[t._v("add")])]}}])})],1)],1)]),a("div",{staticClass:"table-gap"}),a("div",{staticClass:"table-section"},[a("h2",{staticClass:"table-title"},[t._v("User Api List")]),a("div",{staticClass:"table-wrapper"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],key:t.tableKey,staticStyle:{width:"100%"},attrs:{data:t.userApiList,border:"",fit:"","highlight-current-row":""}},[a("el-table-column",{attrs:{label:"ID",prop:"id",align:"center",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[a("span",[t._v(t._s(i.id))])]}}])}),a("el-table-column",{attrs:{label:"Method",width:"150px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[a("span",[t._v(t._s(i.request_method))])]}}])}),a("el-table-column",{attrs:{label:"Path","min-width":"150px"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[a("span",{staticClass:"link-type"},[t._v(t._s(i.sample_url))])]}}])}),a("el-table-column",{attrs:{label:"Description",width:"310px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[a("span",[t._v(t._s(i.function_description))])]}}])}),a("el-table-column",{attrs:{label:"Actions",width:"210px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row,r=e.$index;return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.editApi(i)}}},[t._v(" Edit ")]),a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(e){return t.removeFromUserApiList(r)}}},[t._v(" Delete ")])]}}])})],1)],1)]),a("el-dialog",{attrs:{visible:t.editDialogVisible,width:"80%",title:"Edit API"},on:{"update:visible":function(e){t.editDialogVisible=e}}},[a("api-edit",{attrs:{"api-data":t.selectedApi},on:{save:t.handleSaveApi,cancel:function(e){t.editDialogVisible=!1}}})],1)],1)},r=[],s=a("c7eb"),n=a("1da1"),o=(a("c740"),a("a434"),a("949f")),l=a("1115"),c={name:"ApiDiscoveryResult",components:{ApiEdit:l["default"]},data:function(){return{tableKey:0,discoveredApiList:[],userApiList:[],listLoading:!0,editDialogVisible:!1,selectedApi:null}},created:function(){this.getApiListData()},methods:{getApiListData:function(){var t=this;return Object(n["a"])(Object(s["a"])().mark((function e(){var a;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.listLoading=!0,e.prev=1,e.next=4,Object(o["h"])({app_id:t.$route.params.id});case 4:a=e.sent,t.discoveredApiList=a.data.discovered_API_list,t.userApiList=a.data.user_API_list,e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](1),console.error("Failed to fetch API list:",e.t0);case 12:return e.prev=12,t.listLoading=!1,e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,9,12,15]])})))()},moveToUserApiList:function(t){var e=this.discoveredApiList.findIndex((function(e){return e.id===t.id}));-1!==e&&(this.userApiList.push(this.discoveredApiList[e]),this.discoveredApiList.splice(e,1))},removeFromUserApiList:function(t){this.discoveredApiList.push(this.userApiList[t]),this.userApiList.splice(t,1)},editApi:function(t){this.selectedApi=t,this.editDialogVisible=!0},handleSaveApi:function(t){var e=this.userApiList.findIndex((function(e){return e.id===t.id}));-1!==e&&this.userApiList.splice(e,1,t),this.editDialogVisible=!1},submitUserApiList:function(){var t=this;return Object(n["a"])(Object(s["a"])().mark((function e(){return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(o["p"])(t.$route.params.id,{user_API_list:t.userApiList,example_API_seqs:[]});case 3:t.$notify.success({title:"成功",message:"API列表已提交",duration:2e3}),e.next=10;break;case 6:e.prev=6,e.t0=e["catch"](0),console.error("Failed to submit user API list:",e.t0),t.$notify.error({title:"错误",message:"提交失败",duration:2e3});case 10:case"end":return e.stop()}}),e,null,[[0,6]])})))()}}},u=c,p=(a("bfc5"),a("2877")),d=Object(p["a"])(u,i,r,!1,null,"fb918988",null);e["default"]=d.exports},bfc5:function(t,e,a){"use strict";a("3b56")}}]);